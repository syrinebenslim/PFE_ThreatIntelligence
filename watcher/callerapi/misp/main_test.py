import json
import pandas as pd

from watcher.callerapi.misp.reader import MispReader


def main():
    # Données JSON d'exemple
    json_test = """
    [{"category": "Artifacts dropped", "comment": "", "deleted": false, "disable_correlation": false, "timestamp": "1456092577", "to_ids": true, "type": "sha1", "uuid": "56ca35a1-df8c-462e-b78d-4a5a9062e56a", "value": "af364ff503da71875b6d7c401a1e98e31450a561"}, {"category": "Network activity", "comment": "", "deleted": false, "disable_correlation": false, "timestamp": "1456092578", "to_ids": true, "type": "ip-dst", "uuid": "56ca35a2-3efc-4e1e-abc9-4bad9062e56a", "value": "84.11.146.62"}, {"category": "Network activity", "comment": "", "deleted": false, "disable_correlation": false, "timestamp": "1456092579", "to_ids": true, "type": "ip-dst", "uuid": "56ca35a3-5298-4c84-8c85-4b549062e56a", "value": "107.6.172.54"}, {"category": "Network activity", "comment": "", "deleted": false, "disable_correlation": false, "timestamp": "1456092580", "to_ids": true, "type": "ip-dst", "uuid": "56ca35a4-14e4-49ce-a9f3-42fb9062e56a", "value": "107.6.181.116"}, {"category": "Artifacts dropped", "comment": "", "deleted": false, "disable_correlation": false, "timestamp": "1456092581", "to_ids": true, "type": "sha1", "uuid": "56ca35a5-7038-407d-bdde-4c109062e56a", "value": "db2b8f49b4e76c2f538a3a6b222c35547c802cef"}, {"category": "Artifacts dropped", "comment": "", "deleted": false, "disable_correlation": false, "timestamp": "1456092582", "to_ids": true, "type": "sha1", "uuid": "56ca35a6-0fe0-494a-bb28-4bb19062e56a", "value": "29968b0c4157f226761073333ff2e82b588ddf8e"}, {"category": "Artifacts dropped", "comment": "", "deleted": false, "disable_correlation": false, "timestamp": "1456092583", "to_ids": true, "type": "sha1", "uuid": "56ca35a7-efe8-4976-a55c-4bb09062e56a", "value": "eeb67e663b2fa980c6b228fc2e04304c8992401d"}, {"category": "Artifacts dropped", "comment": "", "deleted": false, "disable_correlation": false, "timestamp": "1456092585", "to_ids": true, "type": "sha1", "uuid": "56ca35a9-0e4c-406f-a36c-4c0f9062e56a", "value": "c8096078f0f6c3fbb6d82c5b00211802168f9cba"}, {"category": "Artifacts dropped", "comment": "", "deleted": false, "disable_correlation": false, "timestamp": "1456092586", "to_ids": true, "type": "sha1", "uuid": "56ca35aa-7310-463e-8b83-421e9062e56a", "value": "457f54e9a0f32f2648f95a8e339d9fd9aed23fa7"}, {"category": "Artifacts dropped", "comment": "", "deleted": false, "disable_correlation": false, "timestamp": "1456092587", "to_ids": true, "type": "sha1", "uuid": "56ca35ab-5014-49af-ab0d-4cd69062e56a", "value": "46a995df8d9918ca0793404110904479b6adcb9f"}, {"category": "Network activity", "comment": "", "deleted": false, "disable_correlation": false, "timestamp": "1456092588", "to_ids": true, "type": "url", "uuid": "56ca35ac-79bc-4c98-a758-4a5a9062e56a", "value": "http://gulfc.haifa.ac.il/index.php/the-ezri-center-in-the-media/291-the-ezri-center-in-the-media"}, {"category": "Network activity", "comment": "", "deleted": false, "disable_correlation": false, "timestamp": "1456092589", "to_ids": true, "type": "domain", "uuid": "56ca35ae-5afc-401b-8323-4bad9062e56a", "value": "gulfc.haifa.ac.il"}, {"category": "Artifacts dropped", "comment": "", "deleted": false, "disable_correlation": false, "timestamp": "1466509603", "to_ids": false, "type": "regkey", "uuid": "56ca35af-4fcc-4589-a06a-4b549062e56a", "value": "HKCUSOFTWAREMicrosoftWindowsCurrentVersionRun"}, {"category": "Artifacts dropped", "comment": "", "deleted": false, "disable_correlation": false, "timestamp": "1456092592", "to_ids": true, "type": "sha1", "uuid": "56ca35b0-46c4-432b-b74a-42fb9062e56a", "value": "64ba130e627dd85c85d6534e769d239080e068dd"}, {"category": "Network activity", "comment": "", "deleted": false, "disable_correlation": false, "timestamp": "1456092593", "to_ids": true, "type": "domain", "uuid": "56ca35b1-34a4-46cb-8ea9-4c109062e56a", "value": "www.iabg.de"}]
    """
    test = """{\n  \"Event\": {\n    \"analysis\": \"2\",\n    \"date\": \"2015-09-01\",\n    \"extends_uuid\": \"\",\n    \"info\": \"The Spy Kittens Are Back: Rocket Kitten 2\",\n    \"publish_timestamp\": \"1517825421\",\n    \"published\": true,\n    \"threat_level_id\": \"3\",\n    \"timestamp\": \"1466509603\",\n    \"uuid\": \"56ca35a0-0f20-4cca-8fc3-4cd69062e56a\",\n    \"Orgc\": {\n      \"name\": \"CUDESO\",\n      \"uuid\": \"56c42374-fdb8-4544-a218-41ffc0a8ab16\"\n    },\n    \"Tag\": [\n      {\n        \"colour\": \"#ffffff\",\n        \"local\": false,\n        \"name\": \"tlp:white\",\n        \"relationship_type\": \"\"\n      }\n    ],\n    \"Attribute\": [\n      {\n        \"category\": \"Artifacts dropped\",\n        \"comment\": \"\",\n        \"deleted\": false,\n        \"disable_correlation\": false,\n        \"timestamp\": \"1456092577\",\n        \"to_ids\": true,\n        \"type\": \"sha1\",\n        \"uuid\": \"56ca35a1-df8c-462e-b78d-4a5a9062e56a\",\n        \"value\": \"af364ff503da71875b6d7c401a1e98e31450a561\"\n      },\n      {\n        \"category\": \"Network activity\",\n        \"comment\": \"\",\n        \"deleted\": false,\n        \"disable_correlation\": false,\n        \"timestamp\": \"1456092578\",\n        \"to_ids\": true,\n        \"type\": \"ip-dst\",\n        \"uuid\": \"56ca35a2-3efc-4e1e-abc9-4bad9062e56a\",\n        \"value\": \"84.11.146.62\"\n      },\n      {\n        \"category\": \"Network activity\",\n        \"comment\": \"\",\n        \"deleted\": false,\n        \"disable_correlation\": false,\n        \"timestamp\": \"1456092579\",\n        \"to_ids\": true,\n        \"type\": \"ip-dst\",\n        \"uuid\": \"56ca35a3-5298-4c84-8c85-4b549062e56a\",\n        \"value\": \"107.6.172.54\"\n      },\n      {\n        \"category\": \"Network activity\",\n        \"comment\": \"\",\n        \"deleted\": false,\n        \"disable_correlation\": false,\n        \"timestamp\": \"1456092580\",\n        \"to_ids\": true,\n        \"type\": \"ip-dst\",\n        \"uuid\": \"56ca35a4-14e4-49ce-a9f3-42fb9062e56a\",\n        \"value\": \"107.6.181.116\"\n      },\n      {\n        \"category\": \"Artifacts dropped\",\n        \"comment\": \"\",\n        \"deleted\": false,\n        \"disable_correlation\": false,\n        \"timestamp\": \"1456092581\",\n        \"to_ids\": true,\n        \"type\": \"sha1\",\n        \"uuid\": \"56ca35a5-7038-407d-bdde-4c109062e56a\",\n        \"value\": \"db2b8f49b4e76c2f538a3a6b222c35547c802cef\"\n      },\n      {\n        \"category\": \"Artifacts dropped\",\n        \"comment\": \"\",\n        \"deleted\": false,\n        \"disable_correlation\": false,\n        \"timestamp\": \"1456092582\",\n        \"to_ids\": true,\n        \"type\": \"sha1\",\n        \"uuid\": \"56ca35a6-0fe0-494a-bb28-4bb19062e56a\",\n        \"value\": \"29968b0c4157f226761073333ff2e82b588ddf8e\"\n      },\n      {\n        \"category\": \"Artifacts dropped\",\n        \"comment\": \"\",\n        \"deleted\": false,\n        \"disable_correlation\": false,\n        \"timestamp\": \"1456092583\",\n        \"to_ids\": true,\n        \"type\": \"sha1\",\n        \"uuid\": \"56ca35a7-efe8-4976-a55c-4bb09062e56a\",\n        \"value\": \"eeb67e663b2fa980c6b228fc2e04304c8992401d\"\n      },\n      {\n        \"category\": \"Artifacts dropped\",\n        \"comment\": \"\",\n        \"deleted\": false,\n        \"disable_correlation\": false,\n        \"timestamp\": \"1456092585\",\n        \"to_ids\": true,\n        \"type\": \"sha1\",\n        \"uuid\": \"56ca35a9-0e4c-406f-a36c-4c0f9062e56a\",\n        \"value\": \"c8096078f0f6c3fbb6d82c5b00211802168f9cba\"\n      },\n      {\n        \"category\": \"Artifacts dropped\",\n        \"comment\": \"\",\n        \"deleted\": false,\n        \"disable_correlation\": false,\n        \"timestamp\": \"1456092586\",\n        \"to_ids\": true,\n        \"type\": \"sha1\",\n        \"uuid\": \"56ca35aa-7310-463e-8b83-421e9062e56a\",\n        \"value\": \"457f54e9a0f32f2648f95a8e339d9fd9aed23fa7\"\n      },\n      {\n        \"category\": \"Artifacts dropped\",\n        \"comment\": \"\",\n        \"deleted\": false,\n        \"disable_correlation\": false,\n        \"timestamp\": \"1456092587\",\n        \"to_ids\": true,\n        \"type\": \"sha1\",\n        \"uuid\": \"56ca35ab-5014-49af-ab0d-4cd69062e56a\",\n        \"value\": \"46a995df8d9918ca0793404110904479b6adcb9f\"\n      },\n      {\n        \"category\": \"Network activity\",\n        \"comment\": \"\",\n        \"deleted\": false,\n        \"disable_correlation\": false,\n        \"timestamp\": \"1456092588\",\n        \"to_ids\": true,\n        \"type\": \"url\",\n        \"uuid\": \"56ca35ac-79bc-4c98-a758-4a5a9062e56a\",\n        \"value\": \"http://gulfc.haifa.ac.il/index.php/the-ezri-center-in-the-media/291-the-ezri-center-in-the-media\"\n      },\n      {\n        \"category\": \"Network activity\",\n        \"comment\": \"\",\n        \"deleted\": false,\n        \"disable_correlation\": false,\n        \"timestamp\": \"1456092589\",\n        \"to_ids\": true,\n        \"type\": \"domain\",\n        \"uuid\": \"56ca35ae-5afc-401b-8323-4bad9062e56a\",\n        \"value\": \"gulfc.haifa.ac.il\"\n      },\n      {\n        \"category\": \"Artifacts dropped\",\n        \"comment\": \"\",\n        \"deleted\": false,\n        \"disable_correlation\": false,\n        \"timestamp\": \"1466509603\",\n        \"to_ids\": false,\n        \"type\": \"regkey\",\n        \"uuid\": \"56ca35af-4fcc-4589-a06a-4b549062e56a\",\n        \"value\": \"HKCU\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\"\n      },\n      {\n        \"category\": \"Artifacts dropped\",\n        \"comment\": \"\",\n        \"deleted\": false,\n        \"disable_correlation\": false,\n        \"timestamp\": \"1456092592\",\n        \"to_ids\": true,\n        \"type\": \"sha1\",\n        \"uuid\": \"56ca35b0-46c4-432b-b74a-42fb9062e56a\",\n        \"value\": \"64ba130e627dd85c85d6534e769d239080e068dd\"\n      },\n      {\n        \"category\": \"Network activity\",\n        \"comment\": \"\",\n        \"deleted\": false,\n        \"disable_correlation\": false,\n        \"timestamp\": \"1456092593\",\n        \"to_ids\": true,\n        \"type\": \"domain\",\n        \"uuid\": \"56ca35b1-34a4-46cb-8ea9-4c109062e56a\",\n        \"value\": \"www.iabg.de\"\n      }\n    ]\n  }\n}"""
    print(test.strip())
    print(MispReader.clean_raw_data(test))
    data = json.loads(json_test)
    df = pd.DataFrame(data)
    df["organisation"] = "CUDESO"

    # Filtrer le DataFrame selon les colonnes désirées
    filtered_df = df[df['to_ids']].copy()

    # Ajouter la colonne 'orga_event'
    filtered_df.loc[:, 'orga_event'] = filtered_df['organisation'] + '_' + filtered_df['uuid']

    # Sélection des colonnes projetées
    projected_df = filtered_df[['organisation', 'type', 'value', 'orga_event', 'timestamp','category']]

    # Affichage du DataFrame projeté
    print("\nDataFrame projeté:")
    print(projected_df)

    # Obtenir les noms des colonnes
    column_names = projected_df.columns

    # Convertir en liste si nécessaire
    column_names_list = column_names.tolist()

    # Afficher les noms des colonnes
    print("\nNoms des colonnes:", column_names)
    print("Noms des colonnes sous forme de liste:", column_names_list)


# Appuyez sur le bouton vert dans la gouttière pour exécuter le script.
if __name__ == '__main__':
    main()
